<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
</head>
<body>
<!-- Text input -->
<th:block th:fragment="textInput(field)">
    <input type="text"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}" 
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
</th:block>

<!-- Textarea input -->
<th:block th:fragment="textareaInput(field)">
  <label th:for="${field.label}">
      <textarea th:name="${field.name}"
                th:placeholder="${field.placeholder}"
                class="w-full p-2 rounded border outline-none bg-white my-5"
                th:text="${field.value}"></textarea>
  </label>
</th:block>

<!-- Select input (dropdown) -->
<th:block th:fragment="selectInput(field)">
  <label th:for="${field.name}">
    <select th:name="${field.name}" class="w-full p-2 rounded border outline-none bg-white my-5">
      <option disabled th:text="${field.name}" selected></option>
      <option th:each="opt : ${field.options}"
              th:value="${opt}"
              th:text="${opt}"
              th:selected="${opt == field.value}"></option>
    </select>
  </label>
  <!-- Validation error for select field -->
  <span th:if="${field.validationErrors != null and field.validationErrors.containsKey(field.name)}"
        th:text="${field.validationErrors[field.name]}"
        style="color:red;">
    </span>
</th:block>

<!-- Checkbox input -->
<th:block th:fragment="checkboxInput(field)">
  <label th:for="${field.name}">
    <input type="checkbox"
           th:name="${field.name}"
           th:value="${field.value}"
           th:checked="${field.value}"
           class="p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- Tags input (multi-select) -->
<th:block th:fragment="tagsInput(field)">
  <label th:for="${field.name}">
    <select th:name="${field.name}" class="w-full p-2 rounded border outline-none bg-white my-5" multiple>
      <option th:each="opt : ${field.options}"
              th:value="${opt}"
              th:text="${opt}"
              th:selected="${#lists.contains(field.value, opt)}"></option>
    </select>
  </label>
</th:block>

<!-- number input -->
<!--<th:block th:fragment="numberInput(field)">-->
<!--  <span th:text="${field.searchOperations}"></span>-->
<!--  <label th:for="${field.name}">-->
<!--    <input type="number"-->
<!--           th:id="${field.name}"-->
<!--           th:name="${field.name}"-->
<!--           th:placeholder="${field.placeholder}"-->
<!--           th:value="${field.value}"-->
<!--           th:attr="required=${field.required ? 'required' : null}" />-->
<!--  </label>-->
<!--</th:block>-->

<!-- number input with search operations -->
<th:block th:fragment="numberInput(field)">
  <label th:for="${field.name}">
    <div class="flex space-x-2 items-center">
      <!-- Operation dropdown -->
      <select th:name="${field.name + 'Operation'}" class="rounded border px-2 py-1">
        <option th:each="op : ${field.searchOperations}"
                th:value="${op}"
                th:text="${op}"></option>
      </select>

      <!-- Value input -->
      <input type="number"
             th:id="${field.name}"
             th:name="${field.name}"
             th:placeholder="${field.placeholder}"
             th:value="${field.value}"
             th:attr="required=${field.required ? 'required' : null}"
             class="border px-2 py-1 rounded w-full" />
    </div>
  </label>
</th:block>


<!-- Time input -->
<th:block th:fragment="timeInput(field)">
  <label th:for="${field.name}">
    <input type="time"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5" />
  </label>
</th:block>

<!-- date input -->
<th:block th:fragment="dateInput(field)">
  <label th:for="${field.name}">
    <input type="date"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- datetime input -->
<th:block th:fragment="dateTimeInput(field)">
  <label th:for="${field.name}">
    <input type="datetime-local"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- tel input -->
<th:block th:fragment="telInput(field)">
  <label th:for="${field.name}">
    <input type="tel"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- url input -->
<th:block th:fragment="urlInput(field)">
  <label th:for="${field.name}">
    <input type="url"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- email input -->
<th:block th:fragment="emailInput(field)">
  <label th:for="${field.name}">
    <input type="email"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- password input -->
<th:block th:fragment="passwordInput(field)">
  <label th:for="${field.name}">
    <input type="password"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- file input -->
<th:block th:fragment="fileInput(field)">
  <label th:for="${field.name}">
    <input type="file"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- radio input -->
<th:block th:fragment="radioInput(field)">
  <label th:for="${field.name}">
    <input type="radio"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- search input -->
<th:block th:fragment="searchInput(field)">
  <label th:for="${field.name}">
    <input type="search"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- range input -->
<th:block th:fragment="rangeInput(field)">
  <label th:for="${field.name}">
    <input type="range"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- color input -->
<th:block th:fragment="colorInput(field)">
  <label th:for="${field.name}">
    <input type="color"
           th:id="${field.name}"
           th:name="${field.name}"
           th:placeholder="${field.placeholder}"
           th:value="${field.value}"
           th:attr="required=${field.required ? 'required' : null}"
           class="w-full p-2 rounded border outline-none bg-white my-5"/>
  </label>
</th:block>

<!-- This block renders the embedded field -->
<th:block th:fragment="embeddedInput(field)">
  <fieldset>
    <legend th:text="${field.label}"></legend>
    <!-- Loop through each embedded field -->
    <div th:each="subField : ${field.formFieldList}">
      <!-- Render different field types based on sub-field type -->
      <label th:for="${subField.name}" th:text="${subField.label}"></label>
      <div th:switch="${subField.type}">
        <!-- Render Text Input -->
        <input th:switch="${subField.type}" type="text" th:name="${subField.name}" th:placeholder="${subField.placeholder}" th:value="${subField.value}" th:required="${subField.required}" class="w-full p-2 rounded border outline-none bg-white my-5" />

        <!-- Render Select Input -->
<!--        <select th:switch="${subField.type}" th:name="${subField.name}">-->
<!--          <option th:each="opt : ${subField.options}" th:value="${opt}" th:text="${opt}"></option>-->
<!--        </select>-->

        <!-- Render Checkbox -->
<!--        <input th:switch="${subField.type}" type="checkbox" th:name="${subField.name}" th:checked="${subField.value}" />-->
      </div>
      <!-- Display validation errors -->
      <span th:if="${subField.validationErrors != null}" th:text="${subField.validationErrors[subField.name]}" style="color:red;"></span>
    </div>
  </fieldset>
</th:block>

<!--search select input-->
<th:block th:fragment="searchSelectInput(field)">
  <div class="form-group">
    <label th:for="${field.name}" th:text="${field.label} + (field.required ? ' *' : '')"></label>

    <input type="text" id="${field.name}-search" placeholder="Search..." onkeyup="filterSelectOptions('${field.name}')" class="w-full">

    <!-- Select input -->
    <select th:name="${field.name}" id="${field.name}" class="w-full">
      <!-- Search input for filtering options -->
      <option disabled th:text="${field.name}" selected></option>
      <option th:each="opt : ${field.options}"
              th:value="${opt.value}"
              th:text="${opt.key}"
              th:selected="${opt == field.value}"></option>
    </select>

    <!-- Error handling -->
    <span th:if="${validationErrors != null and validationErrors[field.name] != null}"
          th:text="${validationErrors[field.name]}"
          style="color:red;display:block;">
    </span>
  </div>
</th:block>

<!-- Radio Input -->
<th:block th:fragment="radioGroupInput(field)">
  <div class="form-group" th:id="${field.name}">
    <label th:text="${field.label}"></label>
    <div th:each="opt : ${field.options}">
      <label>
        <input type="radio"
               th:name="${field.name}"
               th:value="${opt}"
               th:checked="${opt == field.value}" />
        <span th:text="${opt}"></span>
      </label>
    </div>
  </div>
</th:block>


<!-- WYSIWYG Input using Quill.js -->
<!--<th:block th:fragment="wysiwygInput(field)">-->
<!--  <label th:text="${field.label}"></label>-->
<!--  <div th:id="'editor-' + ${field.name}" class="quill-editor"></div>-->
<!--  <input type="hidden" th:name="${field.name}" th:id="quillInput" />-->
<!--</th:block>-->
<th:block th:fragment="wysiwygInput(field)">
  <label th:text="${field.label}"></label>
  <div th:attr="id='editor-' + ${field.name}" class="quill-editor" th:data-target="${field.name}"></div>
  <input type="hidden" th:name="${field.name}" th:id="${field.name + '-input'}" th:value="${field.value}" />
</th:block>

<!-- Range Input with Live Display -->
<th:block th:fragment="rangeInput(field)">
  <label th:for="${field.name}" th:text="${field.label}"></label>
  <input type="range"
         th:id="${field.name}"
         th:name="${field.name}"
         th:value="${field.value}"
         th:min="${field.min}"
         th:max="${field.max}"
         oninput="document.getElementById('${field.name}-value').textContent = this.value" />
  <span th:id="${field.name + '-value'}" th:text="${field.value}"></span>
</th:block>


<script>
  // Function to filter the options based on the search input
  console.log("in searchselectinput field");
  function filterSelectOptions(selectId) {
    var input = document.getElementById(selectId + '-search');
    var filter = input.value.toLowerCase();
    var select = document.getElementById(selectId);
    var options = select.getElementsByTagName('option');

    // Loop through all options and hide those that don't match the search term
    for (var i = 0; i < options.length; i++) {
      var option = options[i];
      var text = option.textContent || option.innerText;

      // Check if the option text matches the search term
      if (text.toLowerCase().indexOf(filter) > -1) {
        option.style.display = ''; // Show matching option
      } else {
        option.style.display = 'none'; // Hide non-matching option
      }
    }
  }
</script>


<!-- Include Choices.js initialization script for search functionality -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Initialize Choices.js for the select field
    new Choices('#${field.name}-select', {
      searchEnabled: true, // Enables the search input field
      itemSelectText: '', // Optional: Text to display when no selection has been made
      shouldSort: false, // Optional: Keeps the options in the original order
    });
  });
</script>

</body>
</html>
